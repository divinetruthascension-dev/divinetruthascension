ğŸŒŸ Starting deploy for DivineTruthAscension...
âœ… Node.js found: v22.18.0
âœ… Netlify CLI found: netlify-cli/23.3.1 android-arm64 node-v22.18.0
ğŸš€ Starting full setup + deploy for DivineTruthAscension...
Hit:1 https://termux.net stable InRelease
Reading package lists...
Building dependency tree...
Reading state information...
All packages are up to date.
Reading package lists...
Building dependency tree...
Reading state information...
Calculating upgrade...
Summary:
  Upgrading: 0, Installing: 0, Removing: 0, Not Upgrading: 0
Reading package lists...
Building dependency tree...
Reading state information...
git is already the newest version (2.51.0).
curl is already the newest version (8.15.0).
wget is already the newest version (1.25.0).
unzip is already the newest version (6.0-9).
nodejs-lts is already the newest version (22.18.0).
Installing:
  zip

Summary:
  Upgrading: 0, Installing: 1, Removing: 0, Not Upgrading: 0
  Download size: 144 kB
  Space needed: 561 kB

Get:1 https://termux.net stable/main aarch64 zip aarch64 3.0-5 [144 kB]
Fetched 144 kB in 1s (100 kB/s)

# ------------------------------
# 2ï¸âƒ£ Node.js and npm verification
# ------------------------------
echo "ğŸ”¹ Node.js version: $(node -v)" | tee -a "$LOG_FILE"
echo "ğŸ”¹ npm version: $(npm -v)" | tee -a "$LOG_FILE"

# ------------------------------
# 3ï¸âƒ£ Git setup
# ------------------------------
echo "ğŸ”¹ Git configuration..." | tee -a "$LOG_FILE"
git config --global user.name "Desmond McBride"
git config --global user.email "divinetruthascension@gmail.com"

# ------------------------------
# 4ï¸âƒ£ Project clone / initialize
# ------------------------------
cd "$HOME"
if [ ! -d "divinetruthascension" ]; then
    echo "ğŸ“ Cloning project repository..." | tee -a "$LOG_FILE"
    # Choose one:
    # HTTPS + PAT:
    # read -p "Enter your GitHub PAT: " GITHUB_PAT
    # git clone https://$GITHUB_PAT@github.com/divinetruthascension-dev/DivineTruthAscension.git
    # SSH:
    git clone git@github.com:divinetruthascension-dev/DivineTruthAscension.git
fi

cd divinetruthascension

# ------------------------------
# 5ï¸âƒ£ npm install dependencies
# ------------------------------
echo "ğŸ“¦ Installing npm dependencies..." | tee -a "$LOG_FILE"
if [ ! -f package-lock.json ]; then
    npm i --package-lock-only | tee -a "$LOG_FILE"
fi

# Fix potential invalid JSON issues
npm install --force | tee -a "$LOG_FILE"

# ------------------------------
# 6ï¸âƒ£ Build step
# ------------------------------
if grep -q "\"build\":" package.json; then
    echo "âš™ï¸ Running npm build..." | tee -a "$LOG_FILE"
    npm run build | tee -a "$LOG_FILE"
else
    echo "âš ï¸ No build script defined in package.json" | tee -a "$LOG_FILE"
fi

# ------------------------------
# 7ï¸âƒ£ Netlify CLI setup
# ------------------------------
if ! command -v netlify &>/dev/null; then
    echo "ğŸ“¥ Installing Netlify CLI..." | tee -a "$LOG_FILE"
    npm install -g netlify-cli | tee -a "$LOG_FILE"
fi

# ------------------------------
# 8ï¸âƒ£ Netlify login/session check
# ------------------------------
NETLIFY_USER=$(netlify status 2>/dev/null | grep "Current User" || true)
if [ -z "$NETLIFY_USER" ]; then
  echo "âš ï¸ Netlify not logged in or session expired" | tee -a "$LOG_FILE"
  netlify logout &>/dev/null || true
  netlify login
else
  echo "âœ… Netlify session active: $NETLIFY_USER" | tee -a "$LOG_FILE"
fi

# ------------------------------
# 9ï¸âƒ£ Deploy to Netlify
# ------------------------------
echo "ğŸš€ Deploying site to Netlify..." | tee -a "$LOG_FILE"
netlify deploy --dir=public --prod | tee -a "$LOG_FILE"

echo "âœ… Full setup + deploy complete!" | tee -a "$LOG_FILE"
echo "ğŸ“„ Log file: $LOG_FILE"Selecting previously unselected package zip.
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 30921 files and directories currently installed.)
Preparing to unpack .../archives/zip_3.0-5_aarch64.deb ...
Unpacking zip (3.0-5) ...
Setting up zip (3.0-5) ...
